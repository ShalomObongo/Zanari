<!-- 
---
story: 1.1
epic: 1
title: Project & Backend Setup
status: Draft
---
-->

# Story 1.1: Project & Backend Setup

**As a developer, I want to initialize the monorepo and configure the Supabase project, so that we have a foundational environment for development.**

## Acceptance Criteria

1.  **Repository Initialization:** A Git monorepo is initialized with the basic folder structure for the mobile app and Supabase functions.
2.  **Supabase Project Setup:** A new Supabase project is created, and environment details are securely stored.
3.  **Mobile App Connection:** The mobile app can successfully connect to the Supabase backend.
4.  **Health Check Function:** A basic "health-check" Supabase Edge Function is created and can be successfully deployed and invoked.

## Dev Notes

This story establishes the entire project foundation. All work must align with the architecture documents.

### Project Structure

The monorepo will be managed by Nx. The required structure is as follows. All file paths in tasks should adhere to this structure.

```
zanari/
├── apps/
│   ├── mobile/              # React Native app
│   └── web/                 # Future web dashboard
├── packages/
│   ├── shared/              # Shared TypeScript types and utilities
│   ├── ui/                  # Shared UI components
│   ├── data/               # Data models and validation schemas
│   └── config/             # Shared configuration
├── supabase/               # Database migrations and edge functions
│   ├── functions/
│   │   ├── _shared/
│   │   └── health-check/
│   │       └── index.ts
│   └── migrations/
├── docs/                   # Documentation
└── infrastructure/         # IaC for future self-hosting
```
*Source: [docs/stories/epic-1-detailed-stories.md, docs/architecture/backend-architecture.md]*

### Tech Stack

- **Monorepo:** Nx (`nx@latest`)
- **Backend:** Supabase (CLI `supabase@latest`)
- **Language:** TypeScript
- **Package Manager:** npm
*Source: [docs/architecture/tech-stack.md]*

### Backend Setup

- A new Supabase project needs to be created via the Supabase CLI (`supabase init`, `supabase start`).
- Environment variables for Supabase URL and keys must be stored in `supabase/.env` and `.env.local` for the frontend, following the pattern in `docs/architecture/development-workflow.md`.
- The "health-check" function should be created at `supabase/functions/health-check/index.ts` and should follow the standard Edge Function template. It should return a simple JSON response: `{ "status": "ok", "timestamp": "..." }`.
*Source: [docs/architecture/backend-architecture.md]*

### Database

- While no tables need to be created for this story, the initial migration file should be generated by Supabase.
- Row Level Security (RLS) should be enabled on the project from the start.
*Source: [docs/architecture/database-schema.md]*

### Testing

- An integration test for the health-check function must be created.
- The test file should be located at `supabase/functions/__tests__/health-check.test.ts`.
- The test should invoke the deployed function and assert a `200 OK` response and the expected JSON body.
*Source: [docs/architecture/testing-strategy.md]*


## Tasks / Subtasks

1.  **Initialize Git Repository:**
    - [x] `git init` in the root directory.
    - [ ] Create a `.gitignore` file suitable for a Node/TypeScript project.

2.  **Set up Nx Monorepo:**
    - [ ] Initialize an Nx workspace.
    - [ ] Create the directory structure outlined in the Dev Notes.

3.  **Create and Configure Supabase Project:**
    - [ ] Run `supabase init` to create the local Supabase project structure within the `supabase` directory.
    - [ ] Run `supabase start` to launch the local services.
    - [ ] Securely note the generated `SUPABASE_URL`, `SUPABASE_ANON_KEY`, and `SUPABASE_SERVICE_ROLE_KEY`.

4.  **Configure Environment Variables:**
    - [ ] Create a `.env.local` file in the root for frontend variables (`EXPO_PUBLIC_SUPABASE_URL`, `EXPO_PUBLIC_SUPABASE_ANON_KEY`).
    - [ ] The `supabase/.env` file should be automatically generated and contain the service role key.
    *Reference: [docs/architecture/development-workflow.md]*

5.  **Set up Basic React Native App:**
    - [ ] Create a new React Native application inside `apps/mobile`.
    - [ ] Add a basic connection test to ensure it can communicate with the local Supabase instance.

6.  **Create Shared Packages:**
    - [ ] Set up the empty directories for `packages/shared`, `packages/ui`, `packages/data`, and `packages/config`.

7.  **Implement Health Check Edge Function:**
    - [ ] Create the function: `supabase functions new health-check`.
    - [ ] Implement the function at `supabase/functions/health-check/index.ts` to return a JSON object with a status of "ok".
    - [ ] Deploy the function locally: `supabase functions deploy health-check`.

8.  **Write Integration Test for Health Check:**
    - [ ] Create the test file `supabase/functions/__tests__/health-check.test.ts`.
    - [ ] Write a test that invokes the `health-check` function and validates the response.
