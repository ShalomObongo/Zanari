# Test Design: Story 1.1

Date: 2025-09-19
Designer: Quinn (Test Architect)
Story: 1.1 - Project & Backend Setup

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 8 (44%)
- Integration tests: 7 (39%)
- E2E tests: 3 (17%)
- Priority distribution: P0: 8, P1: 7, P2: 3

## Test Scenarios by Acceptance Criteria

### AC1: Repository Initialization
A Git monorepo is initialized with the basic folder structure for the mobile app and Supabase functions.

#### Scenarios

| ID           | Level       | Priority | Test                          | Justification                     |
| ------------ | ----------- | -------- | ----------------------------- | -------------------------------- |
| 1.1-UNIT-001 | Unit        | P0       | Validate .gitignore blocks secrets | Critical security validation     |
| 1.1-UNIT-002 | Unit        | P1       | Nx workspace structure validation | Configuration verification       |
| 1.1-INT-001  | Integration | P0       | Git repository initialization | Foundational infrastructure test |
| 1.1-INT-002  | Integration | P1       | Nx monorepo build validation   | Tooling integration test         |

### AC2: Supabase Project Setup
A new Supabase project is created, and environment details are securely stored.

#### Scenarios

| ID           | Level       | Priority | Test                          | Justification                     |
| ------------ | ----------- | -------- | ----------------------------- | -------------------------------- |
| 1.1-UNIT-003 | Unit        | P0       | Environment variable validation | Security-critical validation     |
| 1.1-UNIT-004 | Unit        | P0       | Secret detection pre-commit hook | Security control validation      |
| 1.1-INT-003  | Integration | P0       | Supabase CLI initialization    | Core service setup test          |
| 1.1-INT-004  | Integration | P0       | Local Supabase services start | Infrastructure validation        |
| 1.1-E2E-001  | E2E         | P1       | Complete local setup workflow | End-to-end environment validation |

### AC3: Mobile App Connection
The mobile app can successfully connect to the Supabase backend.

#### Scenarios

| ID           | Level       | Priority | Test                          | Justification                     |
| ------------ | ----------- | -------- | ----------------------------- | -------------------------------- |
| 1.1-UNIT-005 | Unit        | P1       | Supabase client configuration | Connection logic validation      |
| 1.1-INT-005  | Integration | P0       | Mobile app to Supabase connection | Critical integration test       |
| 1.1-E2E-002  | E2E         | P0       | App connection test on device | Real-world validation           |

### AC4: Health Check Function
A basic "health-check" Supabase Edge Function is created and can be successfully deployed and invoked.

#### Scenarios

| ID           | Level       | Priority | Test                          | Justification                     |
| ------------ | ----------- | -------- | ----------------------------- | -------------------------------- |
| 1.1-UNIT-006 | Unit        | P1       | Health check function logic   | Function behavior validation      |
| 1.1-UNIT-007 | Unit        | P0       | Input validation on health check | Security validation             |
| 1.1-UNIT-008 | Unit        | P1       | Response format validation     | Output contract validation       |
| 1.1-INT-006  | Integration | P0       | Function deployment and invocation | Deployment pipeline test      |
| 1.1-E2E-003  | E2E         | P1       | Health check endpoint access | External access validation      |

## Risk Coverage

### Critical Risk Mitigation

**SEC-001: Supabase Service Role Key Exposure**
- Mitigated by: 1.1-UNIT-003, 1.1-UNIT-004
- Coverage: Environment validation and secret detection

**SEC-002: Database Security Misconfiguration**
- Mitigated by: 1.1-INT-003, 1.1-INT-004
- Coverage: RLS validation during setup

**OPS-001: Environment Setup Inconsistencies**
- Mitigated by: 1.1-E2E-001, 1.1-INT-001, 1.1-INT-002
- Coverage: Complete environment workflow validation

## Detailed Test Scenarios

### P0 Critical Tests (Must Pass)

#### 1.1-UNIT-001: Validate .gitignore blocks secrets
```yaml
description: "Verify .gitignore contains SUPABASE_SERVICE_ROLE_KEY and other secrets"
priority: P0
level: unit
justification: "Prevents accidental secret exposure in version control"
mitigates_risks: ["SEC-001"]
test_data: ["SUPABASE_SERVICE_ROLE_KEY", "SUPABASE_ANON_KEY", ".env.local"]
```

#### 1.1-INT-005: Mobile app to Supabase connection
```yaml
description: "Test React Native app can establish connection to local Supabase instance"
priority: P0
level: integration
justification: "Core functionality - app-backend communication"
mitigates_risks: ["OPS-001"]
test_environment: "Local Supabase with mobile app"
```

#### 1.1-INT-006: Function deployment and invocation
```yaml
description: "Deploy health-check function and verify successful invocation"
priority: P0
level: integration
justification: "Validates complete function deployment pipeline"
test_environment: "Local Supabase development environment"
```

### P1 High Priority Tests

#### 1.1-UNIT-006: Health check function logic
```yaml
description: "Test health-check function returns correct JSON format and status"
priority: P1
level: unit
justification: "Core function behavior validation"
test_data: ['{"status": "ok", "timestamp": "2025-09-19T12:00:00Z"}']
```

#### 1.1-E2E-001: Complete local setup workflow
```yaml
description: "Execute full setup from git init to working local environment"
priority: P1
level: e2e
justification: "Validates complete developer setup experience"
mitigates_risks: ["OPS-001"]
```

### P2 Medium Priority Tests

#### 1.1-UNIT-002: Nx workspace structure validation
```yaml
description: "Verify Nx workspace generates expected directory structure"
priority: P2
level: unit
justification: "Configuration validation, can be manually verified"
```

## Recommended Execution Order

1. **P0 Unit Tests** (Fast feedback on critical issues)
   - 1.1-UNIT-001: .gitignore validation
   - 1.1-UNIT-003: Environment validation
   - 1.1-UNIT-004: Secret detection
   - 1.1-UNIT-007: Health check input validation

2. **P0 Integration Tests** (Component interaction)
   - 1.1-INT-001: Git repository initialization
   - 1.1-INT-003: Supabase CLI initialization
   - 1.1-INT-004: Local services start
   - 1.1-INT-005: Mobile app connection
   - 1.1-INT-006: Function deployment

3. **P0 E2E Tests** (Complete workflows)
   - 1.1-E2E-002: App connection on device
   - 1.1-E2E-003: Health check endpoint access

4. **P1 Tests** (Core functionality)
   - Remaining P1 unit and integration tests
   - 1.1-E2E-001: Complete setup workflow

5. **P2 Tests** (If time permits)
   - Configuration and structure validation tests

## Test Environment Requirements

### Unit Tests
- Node.js environment
- Mock file system access
- Test environment variables

### Integration Tests
- Local Supabase instance
- Git repository
- Nx workspace
- Mobile app dependencies

### E2E Tests
- Physical device or simulator
- Local network access
- Complete development environment

## Test Data Requirements

### Security Tests
- Sample environment variables
- Test secret keys (fake values)
- Various .gitignore configurations

### Integration Tests
- Valid Supabase configuration
- Test database (if applicable)
- Mobile app build configuration

### E2E Tests
- Real device/simulator setup
- Network configuration
- Development build of mobile app

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
- [x] Critical risks have corresponding mitigations
- [x] Security-focused tests are P0 priority

## Gate Summary

test_design:
  scenarios_total: 18
  by_level:
    unit: 8
    integration: 7
    e2e: 3
  by_priority:
    p0: 8
    p1: 7
    p2: 3
  coverage_gaps: []

Test design matrix: docs/qa/assessments/1.1-test-design-20250919.md
P0 tests identified: 8